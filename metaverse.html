<html><head>
<style>
  body {
    margin: 0;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: #000;
  }
  
  .stage {
    perspective: 1000px;
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  .scene {
    transform-style: preserve-3d;
    position: relative;
    transition: transform 0.3s ease;
  }
  
  .screen-container {
    transform-style: preserve-3d;
    transform: translateZ(0px);
    width: 90vw;
    max-width: 800px;
  }
  
  .screen {
    width: 100%;
    aspect-ratio: 16/9;
    border: 20px solid #333;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 0 30px rgba(255,255,255,0.1);
  }

  .screen iframe {
    width: 100%;
    height: 100%;
  }
  
  .spotlights {
    position: absolute;
    width: 100%;
    height: 100%;
  }
  
  .spotlight {
    position: absolute;
    width: 20px;
    height: 100px;
    background: #444;
    transform-style: preserve-3d;
  }
  
  .light-beam {
    position: absolute;
    width: 100px;
    height: 200px;
    background: radial-gradient(ellipse at top, rgba(255,255,255,0.2), transparent 70%);
    transform-origin: top;
    animation: flicker 2s infinite alternate;
  }

  .laser {
    position: absolute;
    width: 2px;
    height: 100vh;
    background: linear-gradient(to bottom, 
      rgba(255,0,0,0.5), 
      rgba(255,0,0,0) 80%);
    animation: laserMove 4s infinite alternate;
  }

  .crowd {
    position: absolute;
    bottom: -50vh;
    left: 0;
    width: 100%;
    height: 50vh;
    transform: rotateX(60deg);
    transform-style: preserve-3d;
  }

  .crowd-dot {
    position: absolute;
    width: 4px;
    height: 4px;
    background: rgba(255,255,255,0.3);
    border-radius: 50%;
    animation: crowdWave 2s infinite alternate;
  }

  .side-light {
    position: absolute;
    width: 10px;
    height: 200px;
    background: #333;
    transform-style: preserve-3d;
  }

  .side-light-beam {
    position: absolute;
    width: 50px;
    height: 300px;
    background: radial-gradient(ellipse at top, rgba(255,255,0,0.2), transparent 70%);
    transform-origin: top;
    animation: flicker 3s infinite alternate;
  }
  
  @keyframes rotate {
    from { transform: rotateY(0deg); }
    to { transform: rotateY(360deg); }
  }
  
  @keyframes flicker {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  @keyframes laserMove {
    0% { transform: rotateZ(-45deg) translateX(-100%); }
    100% { transform: rotateZ(45deg) translateX(100%); }
  }

  @keyframes crowdWave {
    0% { transform: translateY(0); }
    100% { transform: translateY(-10px); }
  }
  
  .controls {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    background: rgba(0,0,0,0.7);
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 600px;
  }
  
  .view-controls {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    background: rgba(0,0,0,0.7);
    padding: 10px;
    border-radius: 10px;
    display: flex;
    gap: 10px;
  }

  .chat-input {
    display: flex;
    gap: 10px;
    width: 100%;
  }

  input {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 5px;
    background: #333;
    color: white;
  }

  button {
    background: #444;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
  }
  
  button:hover {
    background: #666;
  }

  .chat-history {
    max-height: 100px;
    overflow-y: auto;
    margin-bottom: 10px;
    color: white;
  }

  .message {
    padding: 5px;
    margin: 5px 0;
    border-radius: 5px;
    background: rgba(255,255,255,0.1);
  }

  .zoom-controls {
    position: fixed;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1000;
    background: rgba(0,0,0,0.7);
    padding: 10px;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .zoom-slider {
    writing-mode: bt-lr;
    -webkit-appearance: slider-vertical;
    width: 8px;
    height: 150px;
    background: #444;
  }

  .zoom-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    background: #666;
    border-radius: 50%;
    cursor: pointer;
  }

  .zoom-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background: #666;
    border-radius: 50%;
    cursor: pointer;
  }

  @media (max-width: 768px) {
    .screen-container {
      width: 95vw;
    }
    
    .screen {
      border-width: 10px;
    }
    
    .controls {
      padding: 10px;
    }
  }
</style>
</head>
<body>

<div class="stage">
  <div class="scene">
    <div class="screen-container">
      <div class="screen">
        <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div>
    </div>
    <div class="spotlights">
      <div class="spotlight" style="left: -200px; transform: translateZ(100px)">
        <div class="light-beam"></div>
      </div>
      <div class="spotlight" style="right: -200px; transform: translateZ(100px)">
        <div class="light-beam"></div>
      </div>
    </div>
    <div class="side-light" style="left: -300px; top: -100px; transform: translateZ(0px)">
      <div class="side-light-beam"></div>
    </div>
    <div class="side-light" style="right: -300px; top: -100px; transform: translateZ(0px)">
      <div class="side-light-beam"></div>
    </div>
    <div class="laser" style="left: 25%"></div>
    <div class="laser" style="left: 75%"></div>
    <div class="crowd" id="crowd"></div>
  </div>
</div>

<div class="zoom-controls">
  <button onclick="resetZoom()">Reset Zoom</button>
  <input type="range" class="zoom-slider" min="500" max="2000" value="1000" orient="vertical" 
         oninput="updateZoom(this.value)">
</div>

<div class="view-controls">
  <button onclick="toggleAutoRotate()">Toggle Auto-Rotate</button>
  <button onclick="resetView()">Reset View</button>
</div>

<div class="controls">
  <div class="chat-history" id="chatHistory"></div>
  <div class="chat-input">
    <input type="text" id="searchInput" placeholder="Search for a YouTube video..." onkeypress="handleKeyPress(event)">
    <button onclick="searchVideo()">Search</button>
  </div>
</div>
<script src="movies.js"></script>
<script>
let autoRotate = false;
let rotationAngle = 0;
let aiMovieDatabase = []; // Will be populated from movies.js

// Wait for movies.js to load
window.onload = function() {
  if (typeof movies !== 'undefined') {
    aiMovieDatabase = movies;
  }
}

function addMessage(text, isUser = false) {
  const chatHistory = document.getElementById('chatHistory');
  const message = document.createElement('div');
  message.className = 'message';
  message.textContent = isUser ? `You: ${text}` : `Bot: ${text}`;
  chatHistory.appendChild(message);
  chatHistory.scrollTop = chatHistory.scrollHeight;
}

function handleKeyPress(event) {
  if (event.key === 'Enter') {
    searchVideo();
  }
}

function extractVideoId(url) {
  const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
  const match = url.match(regExp);
  return (match && match[2].length === 11) ? match[2] : url;
}

function searchVideo() {
  const input = document.getElementById('searchInput');
  const query = input.value.trim().toLowerCase();
  
  if (!query) {
    addMessage('Please enter a search term or YouTube URL');
    return;
  }

  // First check if it's a direct YouTube URL
  if (query.includes('youtube.com') || query.includes('youtu.be')) {
    const videoId = extractVideoId(query);
    updateVideo(videoId);
    addMessage(query, true);
    addMessage('Direct YouTube URL detected! Enjoy watching ðŸŽ¬');
    return;
  }

  // Search in movie database
  if (aiMovieDatabase.length > 0) {
    const foundMovie = aiMovieDatabase.find(movie => 
      movie.title.toLowerCase().includes(query) || 
      movie.description.toLowerCase().includes(query)
    );

    if (foundMovie && foundMovie.youtubeId) {
      updateVideo(foundMovie.youtubeId);
      addMessage(query, true);
      addMessage(`Found "${foundMovie.title}"! Enjoy watching ðŸŽ¬`);
    } else {
      // If not found in database, use as regular YouTube search term
      const videoId = query;
      updateVideo(videoId);
      addMessage(query, true);
      addMessage('Video updated! Note: For best results, try using a YouTube URL or search for movies in our database.');
    }
  } else {
    // Fallback if database isn't loaded
    const videoId = query;
    updateVideo(videoId);
    addMessage(query, true);
    addMessage('Video updated! Note: Movie database not loaded, using direct search.');
  }
  
  input.value = '';
}

function updateVideo(videoId) {
  const iframe = document.querySelector('iframe');
  iframe.src = `https://www.youtube.com/embed/${videoId}`;
}

function toggleAutoRotate() {
  autoRotate = !autoRotate;
  if (autoRotate) {
    rotateScene();
  }
}

function resetView() {
  const scene = document.querySelector('.scene');
  scene.style.transform = 'rotateX(0deg) rotateY(0deg)';
  autoRotate = false;
}

function rotateScene() {
  if (!autoRotate) return;
  
  const scene = document.querySelector('.scene');
  rotationAngle += 0.5;
  scene.style.transform = `rotateY(${rotationAngle}deg)`;
  requestAnimationFrame(rotateScene);
}

// Add crowd dots
const crowd = document.getElementById('crowd');
for (let i = 0; i < 200; i++) {
  const dot = document.createElement('div');
  dot.className = 'crowd-dot';
  dot.style.left = Math.random() * 100 + '%';
  dot.style.top = Math.random() * 100 + '%';
  dot.style.animationDelay = Math.random() * 2 + 's';
  crowd.appendChild(dot);
}

// Add zoom control
function updateZoom(value) {
  const stage = document.querySelector('.stage');
  stage.style.perspective = `${value}px`;
}

function resetZoom() {
  const stage = document.querySelector('.stage');
  stage.style.perspective = '1000px';
  document.querySelector('.zoom-slider').value = 1000;
}

// Update mouse control to include depth movement
let isDragging = false;
let previousMousePosition = { x: 0, y: 0 };
let currentZPosition = 0;

document.addEventListener('mousedown', (e) => {
  isDragging = true;
  previousMousePosition = { x: e.clientX, y: e.clientY };
});

document.addEventListener('mousemove', (e) => {
  if (!isDragging || autoRotate) return;
  
  const scene = document.querySelector('.scene');
  const deltaX = e.clientX - previousMousePosition.x;
  const deltaY = e.clientY - previousMousePosition.y;
  
  rotationAngle += deltaX * 0.5;
  const xRotation = Math.max(-30, Math.min(30, deltaY * 0.5));
  
  scene.style.transform = `rotateY(${rotationAngle}deg) rotateX(${xRotation}deg) translateZ(${currentZPosition}px)`;
  
  previousMousePosition = { x: e.clientX, y: e.clientY };
});

document.addEventListener('mouseup', () => {
  isDragging = false;
});

// Add mouse wheel control for depth
document.addEventListener('wheel', (e) => {
  e.preventDefault();
  const scene = document.querySelector('.scene');
  currentZPosition = Math.max(-500, Math.min(500, currentZPosition - e.deltaY));
  
  scene.style.transform = `rotateY(${rotationAngle}deg) translateZ(${currentZPosition}px)`;
}, { passive: false });

</script>

</body></html>
