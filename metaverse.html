<html><head><title>Interactive Stadium Concert Experience</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@widgetbot/crate@3"></script>
<script src="movies.js"></script>
<style>
  body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
  canvas { display: block; }
  #video-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: -1;
  }
  .button {
    position: absolute;
    padding: 10px 20px;
    font-size: 16px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .button:hover {
    background-color: #45a049;
  }
  #marketplace-btn { top: 20px; right: 20px; }
  #sponsors-btn { top: 70px; right: 20px; }
  #discord-btn { top: 120px; right: 20px; }
  .modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }
  .modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 600px;
    border-radius: 10px;
  }
  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }
  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }
  .product, .sponsor {
    margin-bottom: 15px;
    padding: 10px;
    background-color: #f0f0f0;
    border-radius: 5px;
  }
  .product button, .sponsor button {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 3px;
    cursor: pointer;
  }
  #instructions {
    position: absolute;
    top: 10px;
    left: 10px;
    background-color: rgba(0,0,0,0.7);
    color: white;
    padding: 10px;
    border-radius: 5px;
    font-size: 14px;
  }
  #chatbot-container {
    position: fixed;
    left: 0;
    bottom: 0;
    width: 300px;
    height: 400px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    display: flex;
    flex-direction: column;
    padding: 10px;
    z-index: 1000;
  }
  #chat-messages {
    flex-grow: 1;
    overflow-y: auto;
    margin-bottom: 10px;
    padding: 10px;
  }
  #chat-input {
    display: flex;
    gap: 10px;
  }
  #user-input {
    flex-grow: 1;
    padding: 8px;
    border-radius: 4px;
    border: none;
  }
  #send-btn {
    padding: 8px 15px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  .chat-message {
    margin-bottom: 10px;
    padding: 8px;
    border-radius: 4px;
  }
  .bot-message {
    background: #4CAF50;
  }
  .user-message {
    background: #2196F3;
    text-align: right;
  }
</style>
</head>
<body>
<div id="scene-container"></div>
<div id="video-container">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/fGKAJrbiMJI?si=n2cNo0IO3pmeK7rf&autoplay=1&mute=1&loop=1&playlist=fGKAJrbiMJI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>
<button id="marketplace-btn" class="button">Marketplace</button>
<button id="sponsors-btn" class="button">Sponsors</button>
<button id="discord-btn" class="button">Chat on Discord</button>

<div id="instructions">
  Use WASD to move, mouse to look around<br>
  Press 'N' to stop moving<br>
  Press 'F' for fireworks, 'L' for light show
</div>

<div id="marketplace-modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Concert Marketplace</h2>
    <div class="product">
      <h3>VIP Backstage Pass</h3>
      <p>Get exclusive access to meet the artists!</p>
      <button onclick="purchase('VIP Backstage Pass')">Buy for $199</button>
    </div>
    <div class="product">
      <h3>Limited Edition T-Shirt</h3>
      <p>Commemorate this epic concert with our exclusive design.</p>
      <button onclick="purchase('Limited Edition T-Shirt')">Buy for $29.99</button>
    </div>
    <div class="product">
      <h3>Digital Album Download</h3>
      <p>Get the studio version of tonight's setlist.</p>
      <button onclick="purchase('Digital Album Download')">Buy for $9.99</button>
    </div>
    <div class="product">
      <h3>AR Concert Experience App</h3>
      <p>Enhance your live experience with our augmented reality app.</p>
      <button onclick="purchase('AR Concert Experience App')">Buy for $4.99</button>
    </div>
  </div>
</div>

<div id="sponsors-modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Event Sponsors</h2>
    <div class="sponsor">
      <h3>MegaSounds Audio Systems</h3>
      <p>Bringing you crystal clear audio tonight!</p>
      <button onclick="visitSponsor('MegaSounds')">Visit Website</button>
    </div>
    <div class="sponsor">
      <h3>LightFX Productions</h3>
      <p>Creating an unforgettable visual experience.</p>
      <button onclick="visitSponsor('LightFX')">Visit Website</button>
    </div>
    <div class="sponsor">
      <h3>ConcertGear Apparel</h3>
      <p>Official merchandise provider for tonight's show.</p>
      <button onclick="visitSponsor('ConcertGear')">Shop Now</button>
    </div>
    <div class="sponsor">
      <h3>StageView Streaming</h3>
      <p>Can't be here? Watch the live stream!</p>
      <button onclick="visitSponsor('StageView')">Start Streaming</button>
    </div>
  </div>
</div>

<div id="chatbot-container">
  <div id="chat-messages"></div>
  <div id="chat-input">
    <input type="text" id="user-input" placeholder="Type your movie request...">
    <button id="send-btn">Send</button>
  </div>
</div>

<script>
let scene, camera, renderer, stadium, stage, screen, crowd, fireworks, colorLights;
let moveForward = false;
let moveBackward = false;
let moveLeft = false;
let moveRight = false;
let canJump = false;
let prevTime = performance.now();
let velocity = new THREE.Vector3();
let direction = new THREE.Vector3();
let vertex = new THREE.Vector3();
let color = new THREE.Color();
let currentVideo = 'https://www.youtube.com/embed/fGKAJrbiMJI?si=n2cNo0IO3pmeK7rf&autoplay=1&mute=1&loop=1&playlist=fGKAJrbiMJI';

  //chatbot
const chatMessages = document.getElementById('chat-messages');
  const userInput = document.getElementById('user-input');
  const sendBtn = document.getElementById('send-btn');
  const iframe = document.getElementById('movie-iframe');
  const moviePlayContainer = document.getElementById('movie-play-container');
  const playMovieBtn = document.getElementById('play-movie-btn');
  const movieTitleElement = document.getElementById('movie-title');

  let currentMovieUrl = "";

  function addChatMessage(message, isBot = false) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `chat-message ${isBot ? 'bot-message' : 'user-message'}`;
    messageDiv.textContent = message;
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  sendBtn.addEventListener('click', () => {
    const userMessage = userInput.value.trim();
    if (!userMessage) return;

    addChatMessage(userMessage);
    userInput.value = '';

    if (typeof getMovieUrl === 'function') {
      const movieUrl = getMovieUrl(userMessage);
      if (movieUrl) {
        addChatMessage("Yes, I have it. Enjoy it!", true);
        currentMovieUrl = movieUrl;
        movieTitleElement.textContent = userMessage;
        moviePlayContainer.style.display = "flex";
      } else {
        addChatMessage("I'm sorry, I don't have that movie. Try another one!", true);
      }
    } else {
      addChatMessage("Error: Movie database not loaded.", true);
    }
  });

  playMovieBtn.addEventListener('click', () => {
    if (currentMovieUrl) {
      iframe.src = currentMovieUrl;
      moviePlayContainer.style.display = "none";
    }
  });
  
  // Lighting
  const ambientLight = new THREE.AmbientLight(0x404040);
  scene.add(ambientLight);
  const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
  directionalLight.position.set(0, 1, 0);
  scene.add(directionalLight);

  // Stadium
  const stadiumGeometry = new THREE.CylinderGeometry(50, 50, 30, 32, 1, true);
  const stadiumMaterial = new THREE.MeshPhongMaterial({color: 0x999999, side: THREE.DoubleSide});
  stadium = new THREE.Mesh(stadiumGeometry, stadiumMaterial);
  scene.add(stadium);

  // Stage
  const stageGeometry = new THREE.BoxGeometry(20, 2, 10);
  const stageMaterial = new THREE.MeshPhongMaterial({color: 0x333333});
  stage = new THREE.Mesh(stageGeometry, stageMaterial);
  stage.position.set(0, -14, 0);
  scene.add(stage);

  // Screen
  const screenGeometry = new THREE.PlaneGeometry(20, 10);
  const screenMaterial = new THREE.MeshBasicMaterial({color: 0xffffff});
  screen = new THREE.Mesh(screenGeometry, screenMaterial);
  screen.position.set(0, -9, -4.9);
  scene.add(screen);

  // Crowd (particle system)
  const crowdGeometry = new THREE.BufferGeometry();
  const crowdMaterial = new THREE.PointsMaterial({color: 0xffffff, size: 0.1});
  const crowdPositions = [];
  for (let i = 0; i < 10000; i++) {
    const theta = THREE.MathUtils.randFloatSpread(Math.PI * 2);
    const radius = 30 + Math.random() * 15;
    crowdPositions.push(
      Math.cos(theta) * radius,
      THREE.MathUtils.randFloatSpread(10) - 10,
      Math.sin(theta) * radius
    );
  }
  crowdGeometry.setAttribute('position', new THREE.Float32BufferAttribute(crowdPositions, 3));
  crowd = new THREE.Points(crowdGeometry, crowdMaterial);
  scene.add(crowd);

  // Fireworks
  fireworks = new THREE.Group();
  scene.add(fireworks);

  // Color Lights
  colorLights = new THREE.Group();
  const colors = [0xff0000, 0x00ff00, 0x0000ff, 0xffff00, 0xff00ff, 0x00ffff];
  for (let i = 0; i < 6; i++) {
    const light = new THREE.PointLight(colors[i], 1, 50);
    light.position.set(
      THREE.MathUtils.randFloatSpread(30),
      10,
      THREE.MathUtils.randFloatSpread(20)
    );
    colorLights.add(light);
  }
  scene.add(colorLights);

  camera.position.set(0, 0, 30);

  // Controls
  const onKeyDown = function (event) {
    switch (event.code) {
      case 'ArrowUp':
      case 'KeyW':
        moveForward = true;
        break;
      case 'ArrowLeft':
      case 'KeyA':
        moveLeft = true;
        break;
      case 'ArrowDown':
      case 'KeyS':
        moveBackward = true;
        break;
      case 'ArrowRight':
      case 'KeyD':
        moveRight = true;
        break;
      case 'KeyN':
        stopMoving();
        break;
      case 'KeyF':
        createFirework();
        break;
      case 'KeyL':
        toggleLightShow();
        break;
    }
  };

  const onKeyUp = function (event) {
    switch (event.code) {
      case 'ArrowUp':
      case 'KeyW':
        moveForward = false;
        break;
      case 'ArrowLeft':
      case 'KeyA':
        moveLeft = false;
        break;
      case 'ArrowDown':
      case 'KeyS':
        moveBackward = false;
        break;
      case 'ArrowRight':
      case 'KeyD':
        moveRight = false;
        break;
    }
  };

  document.addEventListener('keydown', onKeyDown);
  document.addEventListener('keyup', onKeyUp);

  document.addEventListener('mousemove', onMouseMove, false);
}

function onMouseMove(event) {
  const movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;
  const movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;

  camera.rotation.y -= movementX * 0.002;
  camera.rotation.x -= movementY * 0.002;

  camera.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, camera.rotation.x));
}

function stopMoving() {
  moveForward = false;
  moveBackward = false;
  moveLeft = false;
  moveRight = false;
  velocity.set(0, 0, 0);
}

function createFirework() {
  const geometry = new THREE.BufferGeometry();
  const material = new THREE.PointsMaterial({
    color: Math.random() * 0xffffff,
    size: 0.1,
    transparent: true,
    opacity: 1
  });

  const positions = [];
  for (let i = 0; i < 500; i++) {
    positions.push(THREE.MathUtils.randFloatSpread(10));
    positions.push(THREE.MathUtils.randFloatSpread(10));
    positions.push(THREE.MathUtils.randFloatSpread(10));
  }
  geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));

  const firework = new THREE.Points(geometry, material);
  firework.position.set(
    THREE.MathUtils.randFloatSpread(60),
    20 + Math.random() * 15,
    THREE.MathUtils.randFloatSpread(30)
  );
  fireworks.add(firework);

  setTimeout(() => {
    fireworks.remove(firework);
  }, 2000);
}

let lightShowActive = false;

function toggleLightShow() {
  lightShowActive = !lightShowActive;
}

function animate() {
  requestAnimationFrame(animate);

  const time = performance.now();
  const delta = (time - prevTime) / 1000;

  velocity.x -= velocity.x * 10.0 * delta;
  velocity.z -= velocity.z * 10.0 * delta;
  velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass

  direction.z = Number(moveForward) - Number(moveBackward);
  direction.x = Number(moveRight) - Number(moveLeft);
  direction.normalize(); // this ensures consistent movements in all directions

  if (moveForward || moveBackward) velocity.z -= direction.z * 400.0 * delta;
  if (moveLeft || moveRight) velocity.x -= direction.x * 400.0 * delta;

  camera.translateX(velocity.x * delta);
  camera.translateY(velocity.y * delta);
  camera.translateZ(velocity.z * delta);

  if (camera.position.y < 10) {
    velocity.y = 0;
    camera.position.y = 10;
    canJump = true;
  }

  crowd.rotation.y += 0.001;
  if (Math.random() < 0.05) createFirework();

  fireworks.children.forEach(firework => {
    firework.material.opacity -= 0.01;
    firework.position.y += 0.1;
  });

  // Animate color lights
  if (lightShowActive) {
    colorLights.children.forEach(light => {
      light.intensity = 0.5 + Math.sin(Date.now() * 0.005) * 0.5;
      light.position.y = 10 + Math.sin(Date.now() * 0.003 + light.position.x) * 5;
    });
  } else {
    colorLights.children.forEach(light => {
      light.intensity = 0.5;
    });
  }

  prevTime = time;

  renderer.render(scene, camera);
}

init();
animate();

// Modal functionality
const marketplaceBtn = document.getElementById('marketplace-btn');
const sponsorsBtn = document.getElementById('sponsors-btn');
const marketplaceModal = document.getElementById('marketplace-modal');
const sponsorsModal = document.getElementById('sponsors-modal');
const closeBtns = document.getElementsByClassName('close');

marketplaceBtn.onclick = () => marketplaceModal.style.display = 'block';
sponsorsBtn.onclick = () => sponsorsModal.style.display = 'block';

Array.from(closeBtns).forEach(btn => {
  btn.onclick = function() {
    marketplaceModal.style.display = 'none';
    sponsorsModal.style.display = 'none';
  }
});

window.onclick = function(event) {
  if (event.target == marketplaceModal) marketplaceModal.style.display = 'none';
  if (event.target == sponsorsModal) sponsorsModal.style.display = 'none';
}

function purchase(item) {
  alert(`Thank you for purchasing the ${item}! Your order has been processed.`);
}

function visitSponsor(sponsor) {
  alert(`Redirecting to ${sponsor}'s website...`);
}

// Discord chat integration
new Crate({
  server: '299881420891881473',
  channel: '355719584830980096',
  location: ['bottom', 'left'],
  color: '#7289DA',
  indicator: true
})

document.getElementById('discord-btn').addEventListener('click', () => {
  Crate.toggle();
});

window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
